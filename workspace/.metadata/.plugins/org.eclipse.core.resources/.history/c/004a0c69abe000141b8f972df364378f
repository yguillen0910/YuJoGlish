/*
 * @(#) PrincipalUserActivity.java  1 01/03/15
 * 
 * Copyrigth (c) 2015 Jorge Hernández, Yuzmhar Guillén
 * Caracas, Venezuela
 * Todos los derechos reservados.
 *   
 */
package com.yujoglish.configuracion.usuario;

import java.util.ArrayList;

import com.yujoglish.R;
import com.yujoglish.customadapter.CustomItemActivity;
import com.yujoglish.dbhelper.DataBaseManager;
import com.yujoglish.util.Util;

import android.app.ActionBar;
import android.app.Activity;
import android.content.Intent;
import android.database.Cursor;
import android.os.Bundle;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.view.View.OnClickListener;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.ListView;
import android.widget.ProgressBar;
import android.widget.TextView;

/**
 * Clase que muestra opciones disponibles en la configuración
 * de usuarios
 *  
 * @author Jorge Hernández
 * @version 1, 01/03/2015 
 */
public class PrincipalUserActivity extends Activity implements OnClickListener {
	
	/*
	 * ActionBar
	 */
	private ActionBar actionBar;

	private TextView textViewNombre;
	private TextView textViewEdad;
	private ListView listViewUsuarioActivo;
	private ArrayList<CustomItemActivity> items = new ArrayList<CustomItemActivity>();
	
	private Button buttonModificarUsuario;
	private Button buttonAgregarUsuario;
	private Button buttonSeleccionarUsuario;
	private DataBaseManager managerDB;
	private Cursor cursor;
	
	private TextView textViewModificar;
	private TextView textViewAgregar;
	private TextView textViewSeleccionar;
	
	private Intent nuevaActividad;
	
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_principal_user);
		
		actionBar = getActionBar();
		
		actionBar.setTitle("Seleccionar Usuario");
		actionBar.setDisplayUseLogoEnabled(false);
		
		listViewUsuarioActivo = (ListView) findViewById(R.id.listView_usuarioActivo);
		
		
		buttonModificarUsuario = (Button) findViewById(R.id.button_modificar_usuario);
		buttonAgregarUsuario = (Button) findViewById(R.id.button_agregar_usuario);
		buttonSeleccionarUsuario = (Button) findViewById(R.id.button_cambiar_usuario);
		
		textViewModificar = (TextView) findViewById(R.id.textView_generado1); 
		textViewAgregar = (TextView) findViewById(R.id.textView_generado2);
		textViewSeleccionar = (TextView) findViewById(R.id.textView_generado3);
		
		textViewModificar.setText("¿No estan tu nombre o edad correctos?");
		textViewAgregar.setText("¿Quieres agregar a un amigo?");
		textViewSeleccionar.setText("¿Queres seleccionar a otro usuario?");
		
		
		
		managerDB = new DataBaseManager(this);
		cursor = managerDB.cargarCursorUsuarioActivo();
		Integer progressBar[]; 
		
		if(cursor.moveToFirst()){
			String nombre=cursor.getString(1);
			String edad = AgeManager.edad(cursor.getString(2));
			progressBar = Util.progressbarUsuario(cursor.getString(0), this);
			//AQUI LLENO LA VAINA
			items.add(new CustomItemActivity(cursor.getString(0),nombre," Edad: "+edad+" años", progressBar[1], progressBar[0],cursor.getString(4)));
			ArrayAdapter<CustomItemActivity> adapter = new MyListAdapter();
			listViewUsuarioActivo.setAdapter(adapter);
			//textViewNombre.setText("Tu Nombre es "+nombre[0]);
			//textViewEdad.setText("Tienes "+AgeManager.edad(cursor.getString(2))+" años");
		}
		else {
			
			managerDB.insertarUsuario("Mi Prueba", "27/01/2010","M");
		}
		
		buttonModificarUsuario.setOnClickListener(this);
		buttonAgregarUsuario.setOnClickListener(this);
		buttonSeleccionarUsuario.setOnClickListener(this);
		
	}
	
	
	@Override
	public void onClick(View v) {
		
		switch (v.getId()) {
		case R.id.button_modificar_usuario:
			
			nuevaActividad =  new Intent(v.getContext(),ModifyUserActivity.class);
			startActivity(nuevaActividad);
			
			break;
			
		case R.id.button_agregar_usuario:
			
			nuevaActividad =  new Intent(v.getContext(),AddUserActivity.class);
			startActivity(nuevaActividad);
			
			break;
			
		case R.id.button_cambiar_usuario:
			
			nuevaActividad =  new Intent(v.getContext(),SelectUserActivity.class);
			startActivity(nuevaActividad);
			
			break;	

		default:
			break;
		}
	}
	
	@Override
	protected void onRestart() {
		super.onRestart();
		

		/*cursor = managerDB.cargarCursorUsuarioActivo();
		if(cursor.moveToFirst()){
			textViewNombre.setText("Tu Nombre: "+cursor.getString(1));
			textViewEdad.setText("Tu edad: "+AgeManager.edad(cursor.getString(2)));
		}*/
	}
	
	@Override
	protected void onDestroy() {
		super.onDestroy();
	}
	
	private class MyListAdapter extends ArrayAdapter<CustomItemActivity>{

		public MyListAdapter() {
			super(PrincipalUserActivity.this, R.layout.activity_custom_items, items);
		}
		
		@Override
		public View getView(int position, View convertView, ViewGroup parent) {
			
			View view = convertView;
			
			if(view == null){
				view = getLayoutInflater().inflate(R.layout.activity_custom_items, null);
			}
			
			CustomItemActivity item = items.get(position);
			
			TextView userName = (TextView) view.findViewById(R.id.tVUserName);
			userName.setText(item.getNombre());
			
			TextView userAge = (TextView) view.findViewById(R.id.tVUserAge);
			userAge.setText(item.getEdad());
			
			TextView userWords = (TextView) view.findViewById(R.id.tVUserWords);
			userWords.setText(item.getPalabras());
			
			ProgressBar progressBar = (ProgressBar) view.findViewById(R.id.pBUser);
			progressBar.setMax(item.getTotalPalabra());
			progressBar.setProgress(item.getCantidadPalabra());
			
			ImageView image = (ImageView) view.findViewById(R.id.iVUserIconItem);
			if(item.getSexo().matches("F")) image.setImageResource(R.drawable.female_ic);
			if(item.getSexo().matches("M")) image.setImageResource(R.drawable.male_ic);
			else image.setVisibility(0);
							
			return view;
		}
		
		
	}
	
	@Override
	public boolean onCreateOptionsMenu(Menu menu) {
		MenuInflater inflater = getMenuInflater();
		inflater.inflate(R.menu.activity_main_actions, menu);

		return super.onCreateOptionsMenu(menu);
	}

	/**
	 * On selecting action bar icons
	 * */
	@Override
	public boolean onOptionsItemSelected(MenuItem item) {
		// Take appropriate action for each action item click
		switch (item.getItemId()) {
	//	case R.id.action_search:
			// search action
		//	return true;
		//case R.id.action_location_found:
			// location found
			//LocationFound();
			//return true;
		case R.id.action_refresh:
			// refresh
			System.out.println("Refresh");
			//refreshMenuItem = item;
			// load the data from server
			//new SyncData().execute();
			//return true;
		case R.id.action_help:
			// help action
			System.out.println("help action");
			return true;
		case R.id.action_check_updates:
			// check for updates action
			System.out.println("check for updates action");
			return true;
		default:
			return super.onOptionsItemSelected(item);
		}
	}

}
